<?php\n\n/**\n * ForgePulse v1.2.0 - Workflow Versioning Examples\n *\n * This file demonstrates the new workflow versioning features introduced in v1.2.0.\n */\n\nrequire __DIR__ . '/../vendor/autoload.php';\n\nuse AlizHarb\\ForgePulse\\Models\\Workflow;\nuse AlizHarb\\ForgePulse\\Enums\\WorkflowStatus;\nuse AlizHarb\\ForgePulse\\Enums\\StepType;\n\n// Example 1: Automatic Versioning\necho \"\\n=== Example 1: Automatic Versioning ===\\n\";\n\n$workflow = Workflow::create([\n    'name' => 'Customer Onboarding',\n    'description' => 'Automated customer onboarding workflow',\n    'status' => WorkflowStatus::DRAFT,\n]);\n\n// Add initial steps\n$workflow->steps()->create([\n    'name' => 'Send Welcome Email',\n    'type' => StepType::NOTIFICATION,\n    'position' => 1,\n    'configuration' => [\n        'notification_class' => 'App\\\\Notifications\\\\WelcomeEmail',\n    ],\n]);\n\n// Save workflow - automatically creates version 1\n$workflow->save();\necho \"Created workflow with automatic version 1\\n\";\n\n// Make changes\n$workflow->steps()->create([\n    'name' => 'Wait 24 Hours',\n    'type' => StepType::DELAY,\n    'position' => 2,\n    'configuration' => ['seconds' => 86400],\n]);\n\n// Save again - automatically creates version 2\n$workflow->save();\necho \"Updated workflow, automatic version 2 created\\n\";\n\n// Example 2: Manual Version Creation\necho \"\\n=== Example 2: Manual Version Creation ===\\n\";\n\n// Create a version with description before making major changes\n$version = $workflow->createVersion('Before adding premium features');\necho \"Created manual version {$version->version_number}: {$version->description}\\n\";\n\n// Make significant changes\n$workflow->steps()->create([\n    'name' => 'Check Premium Status',\n    'type' => StepType::CONDITION,\n    'position' => 3,\n    'conditions' => [\n        'operator' => 'and',\n        'rules' => [\n            ['field' => 'user.subscription', 'operator' => '==', 'value' => 'premium'],\n        ],\n    ],\n]);\n\n$workflow->save();\necho \"Made changes and saved (version {$workflow->latestVersion()->version_number})\\n\";\n\n// Example 3: View Version History\necho \"\\n=== Example 3: View Version History ===\\n\";\n\n$versions = $workflow->versions;\necho \"Total versions: {$versions->count()}\\n\";\n\nforeach ($versions as $version) {\n    echo \"  - Version {$version->version_number}: {$version->description}\\n\";\n    echo \"    Created: {$version->created_at->format('Y-m-d H:i:s')}\\n\";\n    echo \"    Steps: \" . count($version->steps_snapshot) . \"\\n\";\n}\n\n// Example 4: Compare Versions\necho \"\\n=== Example 4: Compare Versions ===\\n\";\n\nif ($versions->count() >= 2) {\n    $latestVersion = $versions->first();\n    $previousVersion = $versions->skip(1)->first();\n    \n    $diff = $latestVersion->compare($previousVersion);\n    \n    echo \"Comparing version {$latestVersion->version_number} with version {$previousVersion->version_number}:\\n\";\n    echo \"  - Steps added: {$diff['steps_added']}\\n\";\n    echo \"  - Steps modified: {$diff['steps_modified']}\\n\";\n    echo \"  - Configuration changed: \" . ($diff['configuration_changed'] ? 'Yes' : 'No') . \"\\n\";\n    echo \"  - Time difference: {$diff['created_at_diff']}\\n\";\n}\n\n// Example 5: Rollback to Previous Version\necho \"\\n=== Example 5: Rollback to Previous Version ===\\n\";\n\nif ($versions->count() >= 2) {\n    $targetVersion = $versions->skip(1)->first();\n    \n    echo \"Current steps: {$workflow->steps->count()}\\n\";\n    echo \"Rolling back to version {$targetVersion->version_number}...\\n\";\n    \n    $workflow->restoreVersion($targetVersion->id);\n    $workflow->refresh();\n    \n    echo \"Rollback complete!\\n\";\n    echo \"Steps after rollback: {$workflow->steps->count()}\\n\";\n    echo \"Latest version is now: {$workflow->latestVersion()->version_number}\\n\";\n}\n\n// Example 6: Version with Custom Description\necho \"\\n=== Example 6: Version with Custom Description ===\\n\";\n\n$customVersion = $workflow->createVersion('Production release v2.1 - Added email verification');\necho \"Created version {$customVersion->version_number} with custom description\\n\";\necho \"Description: {$customVersion->description}\\n\";\n\n// Example 7: Check Latest Version\necho \"\\n=== Example 7: Check Latest Version ===\\n\";\n\n$latest = $workflow->latestVersion();\nif ($latest) {\n    echo \"Latest version: {$latest->version_number}\\n\";\n    echo \"Created at: {$latest->created_at->format('Y-m-d H:i:s')}\\n\";\n    echo \"Description: {$latest->description}\\n\";\n    \n    if ($latest->restored_at) {\n        echo \"This version was restored at: {$latest->restored_at->format('Y-m-d H:i:s')}\\n\";\n    }\n}\n\necho \"\\n=== Versioning Examples Complete ===\\n\\n\";\n
